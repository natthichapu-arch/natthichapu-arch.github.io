<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>Secure Chat - กรณีศึกษา 1</title>
  <style>
    body { font-family: sans-serif; background:#f4f4f4; padding:20px; }
    #chat { border:1px solid #ccc; background:#fff; padding:10px; width:400px; height:250px; overflow-y:auto; margin-bottom:10px; }
    .msg { padding:6px; margin:4px 0; border-radius:6px; }
    .userA { background:#d1f7d1; text-align:left; }
    .userB { background:#d1e0f7; text-align:right; }
    .alert { color:red; font-weight:bold; }
  </style>
</head>
<body>
  <h2>กรณีศึกษา 1: แชทกลุ่มหลุดมือ</h2>
  <div id="chat"></div>

  <select id="userSelect">
    <option value="A">User A</option>
    <option value="B">User B</option>
  </select>
  <input id="msgInput" placeholder="พิมพ์ข้อความ..." />
  <button onclick="sendMsg()">ส่ง</button>

  <script>
    const ws = new WebSocket("ws://localhost:8080");
    const chat = document.getElementById("chat");
    const input = document.getElementById("msgInput");
    const userSelect = document.getElementById("userSelect");

    // เมื่อได้รับข้อความ
    ws.onmessage = (event) => {
      const data = JSON.parse(event.data);

      if (data.type === "msg") {
        addMsg(data.user, data.text);
        // ตั้งเวลาให้หายไป 60 วิ
        setTimeout(() => {
          const last = chat.lastChild;
          if (last && last.dataset.id === data.id) {
            last.remove();
          }
        }, 60000);
      }

      if (data.type === "alert") {
        const div = document.createElement("div");
        div.className = "alert";
        div.textContent = `⚠️ User ${data.user} พยายามแคปหน้าจอ!`;
        chat.appendChild(div);
        chat.scrollTop = chat.scrollHeight;
      }
    };

    // ฟังก์ชันส่งข้อความ
    function sendMsg() {
      if (!input.value.trim()) return;
      const msg = {
        type: "msg",
        user: userSelect.value,
        text: input.value.trim(),
        id: Date.now()
      };
      ws.send(JSON.stringify(msg));
      input.value = "";
    }

    // ฟังก์ชันเพิ่มข้อความ
    function addMsg(user, text) {
      const div = document.createElement("div");
      div.className = "msg user" + user;
      div.dataset.id = Date.now();
      div.textContent = `User ${user}: ${text}`;
      chat.appendChild(div);
      chat.scrollTop = chat.scrollHeight;
    }

    // ฟังก์ชันแจ้งเตือนเมื่อ PrintScreen
    document.addEventListener("keydown", (e) => {
      if (e.key === "PrintScreen") {
        const alert = {
          type: "alert",
          user: userSelect.value
        };
        ws.send(JSON.stringify(alert));
      }
    });
  </script>
</body>
</html>
